<script>
async function loadBulletin() {
    const API_KEY = 'AIzaSyBZ0TIaGkEQDYLFeIfC0_zTygolYEZd3Oc'; 
    const CAL_ID = 'ceab82d01e29c237da2e761555f2d2c2da76431b94e0def035ff04410e2cd71d@group.calendar.google.com';
    
    // Cache-buster: adds a random number so Google doesn't show you old "empty" data
    const cb = Math.floor(Math.random() * 1000);
    
    // Set time to the very start of today (Gainesville time)
    const startOfToday = new Date();
    startOfToday.setHours(0,0,0,0);
    const timeMin = startOfToday.toISOString();
    
    const url = `https://www.googleapis.com/calendar/v3/calendars/${CAL_ID}/events?key=${API_KEY}&timeMin=${timeMin}&maxResults=5&singleEvents=true&orderBy=startTime&cb=${cb}`;

    try {
        const response = await fetch(url);
        
        // If the restriction is the problem, this will catch the 403 error
        if (!response.ok) {
            const err = await response.json();
            document.getElementById('bulletin-list').innerHTML = `<p style="text-align:center;">API Error: ${err.error.message}</p>`;
            return;
        }

        const data = await response.json();
        const container = document.getElementById('bulletin-list');

        if (!data.items || data.items.length === 0) {
            container.innerHTML = "<p style='text-align:center;'>No events found. Add an event to tomorrow to test.</p>";
            return;
        }

        container.innerHTML = ''; 
        data.items.forEach(event => {
            const start = new Date(event.start.dateTime || event.start.date);
            const day = start.getDate();
            const month = start.toLocaleString('en-US', { month: 'short' });
            const timeLabel = event.start.dateTime ? start.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' }) : 'All Day';

            container.innerHTML += `
                <div class="event-entry">
                    <div class="event-date-box">
                        <span class="event-day">${day}</span>
                        <span class="event-month">${month}</span>
                    </div>
                    <div class="event-info">
                        <span class="event-meta">CLAY COUNTY â€¢ ${timeLabel}</span>
                        <h4>${event.summary}</h4>
                        <p class="event-desc">${(event.description || "Community Event").substring(0, 100)}...</p>
                    </div>
                </div>`;
        });
    } catch (err) {
        document.getElementById('bulletin-list').innerHTML = "<p style='text-align:center;'>Connection Error.</p>";
    }
}
loadBulletin();
</script>
